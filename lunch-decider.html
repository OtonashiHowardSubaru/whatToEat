<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä»Šæ—¥åˆé¤æ±ºå®šå™¨ï¼ˆGoogle Sheetsç‰ˆï¼‰</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Microsoft JhengHei', Arial, sans-serif;
      background: linear-gradient(135deg, #FFE5B4, #FFD700);
      color: #333;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 20px 0;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.5rem;
      color: #8B4513;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .main-content {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
    }

    .wheel-section, .management-section {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      flex: 1;
      min-width: 300px;
      max-width: 500px;
    }

    .section-title {
      text-align: center;
      color: #8B4513;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #FFD700;
    }

    /* è½¬ç›˜æ ·å¼ */
    #wheel-container {
      position: relative;
      width: 350px;
      height: 350px;
      margin: 0 auto;
    }

    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      border: 8px solid #8B4513;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
      transform: rotate(0deg);
    }

    .wheel-segment {
      position: absolute;
      width: 50%;
      height: 50%;
      transform-origin: bottom right;
      left: 0;
      top: 0;
      clip-path: polygon(0 0, 100% 0, 100% 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .segment-text {
      position: absolute;
      left: 50%;
      top: 25%;
      transform-origin: 0 100px;
      width: 100px;
      text-align: center;
      font-weight: bold;
      font-size: 14px;
      color: white;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
      transform: rotate(45deg);
    }

    #pointer {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 40px;
      background: #FF4500;
      clip-path: polygon(50% 100%, 0 0, 100% 0);
      z-index: 10;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    }

    #spin-button {
      display: block;
      margin: 30px auto 0;
      padding: 15px 40px;
      font-size: 1.2rem;
      background: linear-gradient(to bottom, #FF8C00, #FF4500);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }

    #spin-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      background: linear-gradient(to bottom, #FF9E20, #FF5510);
    }

    #spin-button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #result {
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      margin-top: 25px;
      min-height: 60px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      color: #8B4513;
    }

    /* ç®¡ç†åŒºåŸŸæ ·å¼ */
    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #8B4513;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #FFD700;
      border-radius: 8px;
      font-size: 1rem;
    }

    #add-button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(to bottom, #32CD32, #228B22);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #add-button:hover {
      background: linear-gradient(to bottom, #42DD42, #329B32);
      transform: translateY(-2px);
    }

    #options-list {
      list-style-type: none;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
      border: 2px solid #FFD700;
      border-radius: 8px;
      padding: 10px;
    }

    #options-list li {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      border-bottom: 1px dashed #eee;
      align-items: center;
    }

    #options-list li:last-child {
      border-bottom: none;
    }

    .remove-button {
      background: #FF4500;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .remove-button:hover {
      background: #ff2500;
      transform: scale(1.05);
    }

    .instructions {
      background: rgba(255, 255, 255, 0.7);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 25px;
      text-align: center;
      font-size: 1.1rem;
    }

    footer {
      text-align: center;
      margin-top: 30px;
      padding: 20px;
      color: #8B4513;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
        align-items: center;
      }
      
      #wheel-container {
        width: 300px;
        height: 300px;
      }
      
      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ½ï¸ ä»Šæ—¥åˆé¤æ±ºå®šå™¨</h1>
      <div class="setup-instructions">
        <h3>è¨­å®šèªªæ˜</h3>
        <ol>
          <li>å»ºç«‹ä¸€å€‹Google Sheetï¼Œç¬¬ä¸€æ¬„(Aæ¬„)ç”¨æ–¼å­˜æ”¾åˆé¤é¸é …</li>
          <li>å°‡Google Sheetè¨­å®šç‚ºã€Œ anyone with the link can view ã€</li>
          <li>åœ¨ä¸‹æ–¹è¼¸å…¥æ‚¨çš„Google Sheetå…¬é–‹é€£çµ</li>
          <li>é»æ“Šã€Œé€£æ¥è³‡æ–™åº«ã€æŒ‰éˆ•è¼‰å…¥é¸é …</li>
        </ol>
            
        <div class="form-group">
          <label for="sheet-url">Google Sheet å…¬é–‹é€£çµ:</label>
          <input type="text" id="sheet-url" placeholder="è«‹è¼¸å…¥Google Sheetçš„å…¬é–‹é€£çµ">
        </div>
      </div>
          
      <div class="auth-section">
        <button id="connect-button">é€£æ¥è³‡æ–™åº«</button>
      </div>
    </header>
    
    <div class="main-content">
      <section class="wheel-section">
        <h2 class="section-title">å¹¸é‹è½‰ç›¤</h2>
        <div id="wheel-container">
          <div id="pointer"></div>
          <div id="wheel"></div>
        </div>
        <button id="spin-button">é–‹å§‹æ—‹è½‰</button>
        <div id="result">ä»Šå¤©åƒä»€éº¼å‘¢ï¼Ÿ</div>
      </section>
      
      <section class="management-section">
        <h2 class="section-title">è³‡æ–™ç®¡ç†</h2>
        <div class="form-group">
          <label for="new-option">æ–°å¢é¸é …:</label>
          <input type="text" id="new-option" placeholder="è¼¸å…¥åˆé¤é¸é …ï¼Œä¾‹å¦‚ï¼šç‰›è‚‰éºµã€å£½å¸ã€æ¼¢å ¡..." disabled>
        </div>
        <button id="add-button" disabled>æ–°å¢é¸é …</button>
        
        <h3 style="margin-top: 25px; color: #8B4513;">ç›®å‰é¸é …</h3>
        <ul id="options-list">
          <li>è«‹å…ˆé€£æ¥è³‡æ–™åº«ä»¥è¼‰å…¥é¸é …</li>
        </ul>
      </section>
    </div>
    
    <footer>
      <p>è³‡æ–™ä¾†æºç‚ºGoogle Sheetsï¼Œæ‰€æœ‰é¸é …å‡å¾é›²ç«¯è³‡æ–™åº«è®€å–</p>
    </footer>
  </div>

  <script>
    // Google Sheetsç›¸é—œè¨­å®š
    let SHEET_ID = '';
    const API_KEY = ''; // ä¸å†éœ€è¦APIé‡‘é‘°
    const RANGE = 'Sheet1!A:A'; // è®€å–ç¬¬ä¸€æ¬„æ‰€æœ‰è³‡æ–™
    
    // é¸é …åˆ—è¡¨
    let options = [];
    
    // è½‰ç›¤é¡è‰²
    const colors = [
      "#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0",
      "#9966FF", "#FF9F40", "#8AC926", "#1982C4",
      "#6A4C93", "#F15BB5", "#00BBF9", "#00F5D4"
    ];
    
    // DOMè¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
    });
    
    // æ›´æ–°é¸é …åˆ—è¡¨
    function updateOptionsList() {
      const optionsList = document.getElementById('options-list');
      optionsList.innerHTML = '';
      
      options.forEach((option, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${option}</span>
          <button class="remove-button" data-index="${index}">åˆªé™¤</button>
        `;
        optionsList.appendChild(li);
      });
      
      // ç¶å®šåˆªé™¤æŒ‰éˆ•äº‹ä»¶
      document.querySelectorAll('.remove-button').forEach(button => {
        button.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          removeOption(index);
        });
      });
    }
    
    // ç¹ªè£½è½‰ç›¤
    function drawWheel() {
      const wheel = document.getElementById('wheel');
      wheel.innerHTML = '';
      
      if (options.length === 0) {
        wheel.style.background = '#f0f0f0';
        return;
      }
      
      const segmentAngle = 360 / options.length;
      
      options.forEach((option, index) => {
        const segment = document.createElement('div');
        segment.className = 'wheel-segment';
        segment.style.transform = `rotate(${index * segmentAngle}deg)`;
        segment.style.backgroundColor = colors[index % colors.length];
        
        const text = document.createElement('div');
        text.className = 'segment-text';
        text.textContent = option;
        text.style.transform = `rotate(${segmentAngle/2}deg)`;
        
        segment.appendChild(text);
        wheel.appendChild(segment);
      });
    }
    
    // è¨­ç½®äº‹ä»¶ç›£è½å™¨
    function setupEventListeners() {
      document.getElementById('connect-button').addEventListener('click', connectDatabase);
      document.getElementById('spin-button').addEventListener('click', spinWheel);
      document.getElementById('add-button').addEventListener('click', addOption);
      document.getElementById('new-option').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addOption();
        }
      });
    }
    
    // é€£æ¥Google Sheetsè³‡æ–™åº«
    function connectDatabase() {
      const sheetUrl = document.getElementById('sheet-url').value.trim();
      
      if (!sheetUrl) {
        showResult('è«‹è¼¸å…¥Google Sheeté€£çµ');
        return;
      }
      
      // å¾URLä¸­æå–Sheet ID
      try {
        const urlParts = sheetUrl.split('/');
        const sheetIdIndex = urlParts.indexOf('d') + 1;
        SHEET_ID = urlParts[sheetIdIndex];
        
        if (!SHEET_ID) {
          throw new Error('ç„¡æ³•å¾é€£çµä¸­æå–Sheet ID');
        }
      } catch (error) {
        showResult('é€£çµæ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥å¾Œå†è©¦');
        return;
      }
      
      // è¼‰å…¥é¸é …
      loadOptions();
    }
    
    // å¾Google Sheetsè¼‰å…¥é¸é …ï¼ˆä½¿ç”¨å…¬é–‹CSVæ–¹å¼ï¼‰
    function loadOptions() {
      showResult('æ­£åœ¨è¼‰å…¥é¸é …...');
      
      // ä½¿ç”¨Google Sheetsçš„CSVåŒ¯å‡ºåŠŸèƒ½
      const csvUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Sheet1&range=A:A`;
      
      fetch(csvUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('ç„¡æ³•è®€å–è³‡æ–™ï¼Œè«‹ç¢ºèªGoogle Sheetå·²è¨­å®šç‚ºå…¬é–‹');
          }
          return response.text();
        })
        .then(data => {
          // è§£æCSVæ•¸æ“š
          const lines = data.split('\n').map(line => line.trim().replace(/"/g, ''));
          options = lines.filter(line => line !== '' && line !== ',');
          
          if (options.length === 0) {
            options = ['ç‰›è‚‰éºµ', 'å£½å¸', 'æ¼¢å ¡', 'ç‚’é£¯', 'æŠ«è–©', 'æ°´é¤ƒ'];
          }
          
          updateOptionsList();
          drawWheel();
          
          // å•Ÿç”¨æ§åˆ¶é …
          document.getElementById('spin-button').disabled = false;
          document.getElementById('add-button').disabled = false;
          document.getElementById('new-option').disabled = false;
          
          showResult('è³‡æ–™è¼‰å…¥æˆåŠŸï¼');
        })
        .catch(error => {
          console.error('è¼‰å…¥é¸é …æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
          showResult(`è¼‰å…¥å¤±æ•—: ${error.message}`);
        });
    }
    
    // æ–°å¢é¸é …ï¼ˆæ³¨æ„ï¼šæ­¤ç‰ˆæœ¬åƒ…åœ¨å‰ç«¯æ–°å¢ï¼Œä¸æœƒæ›´æ–°Google Sheetï¼‰
    function addOption() {
      const input = document.getElementById('new-option');
      const value = input.value.trim();
      
      if (!value) {
        showResult('è«‹è¼¸å…¥é¸é …åç¨±');
        return;
      }
      
      if (options.includes(value)) {
        showResult('é¸é …å·²å­˜åœ¨ï¼');
        return;
      }
      
      options.push(value);
      updateOptionsList();
      drawWheel();
      input.value = '';
      showResult(`å·²æ–°å¢é¸é …: ${value}`);
      
      // æç¤ºç”¨æˆ¶æ­¤ç‰ˆæœ¬ä¸æœƒåŒæ­¥åˆ°Google Sheet
      setTimeout(() => {
        showResult('æ³¨æ„ï¼šæ­¤ç‰ˆæœ¬åƒ…åœ¨å‰ç«¯æ–°å¢é¸é …ï¼Œä¸æœƒåŒæ­¥åˆ°Google Sheet');
      }, 2000);
    }
    
    // åˆªé™¤é¸é …ï¼ˆæ³¨æ„ï¼šæ­¤ç‰ˆæœ¬åƒ…åœ¨å‰ç«¯åˆªé™¤ï¼Œä¸æœƒæ›´æ–°Google Sheetï¼‰
    function removeOption(index) {
      if (index < 0 || index >= options.length) return;
      
      const removed = options.splice(index, 1)[0];
      updateOptionsList();
      drawWheel();
      showResult(`å·²åˆªé™¤é¸é …: ${removed}`);
      
      // æç¤ºç”¨æˆ¶æ­¤ç‰ˆæœ¬ä¸æœƒåŒæ­¥åˆ°Google Sheet
      setTimeout(() => {
        showResult('æ³¨æ„ï¼šæ­¤ç‰ˆæœ¬åƒ…åœ¨å‰ç«¯åˆªé™¤é¸é …ï¼Œä¸æœƒåŒæ­¥åˆ°Google Sheet');
      }, 2000);
    }
    
    // æ—‹è½‰è½‰ç›¤
    function spinWheel() {
      if (options.length < 2) {
        showResult('è‡³å°‘éœ€è¦å…©å€‹é¸é …æ‰èƒ½æ—‹è½‰ï¼');
        return;
      }
      
      const spinButton = document.getElementById('spin-button');
      spinButton.disabled = true;
      showResult('æ—‹è½‰ä¸­...');
      
      const wheel = document.getElementById('wheel');
      const spins = 5; // æ—‹è½‰åœˆæ•¸
      const extraDegrees = Math.floor(Math.random() * 360);
      const totalDegrees = spins * 360 + extraDegrees;
      
      wheel.style.transform = `rotate(${totalDegrees}deg)`;
      
      // è¨ˆç®—çµæœ
      setTimeout(() => {
        const segmentAngle = 360 / options.length;
        // èª¿æ•´è§’åº¦è¨ˆç®—ä»¥æ­£ç¢ºç²å–çµæœ
        const normalizedDegrees = (360 - (totalDegrees % 360)) % 360;
        const selectedIndex = Math.floor(normalizedDegrees / segmentAngle);
        const result = options[selectedIndex];
        
        showResult(`ä»Šå¤©åˆé¤åƒ: ${result}`);
        spinButton.disabled = false;
      }, 5000);
    }
    
    // é¡¯ç¤ºçµæœ
    function showResult(message) {
      document.getElementById('result').textContent = message;
    }
  </script>
</body>
</html>