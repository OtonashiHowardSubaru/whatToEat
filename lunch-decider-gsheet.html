<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä»Šæ—¥åˆé¤æ±ºå®šå™¨</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Microsoft JhengHei', Arial, sans-serif;
      background: linear-gradient(135deg, #FFE5B4, #FFD700);
      color: #333;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 20px 0;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.5rem;
      color: #8B4513;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .main-content {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
    }

    .wheel-section, .management-section {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      flex: 1;
      min-width: 300px;
      max-width: 500px;
    }

    .section-title {
      text-align: center;
      color: #8B4513;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #FFD700;
    }

    /* è½¬ç›˜æ ·å¼ */
    #wheel-container {
      position: relative;
      width: 350px;
      height: 350px;
      margin: 0 auto;
    }

    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      border: 8px solid #8B4513;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
      transform: rotate(0deg);
    }

    .wheel-segment {
      position: absolute;
      width: 50%;
      height: 50%;
      transform-origin: bottom right;
      left: 0;
      top: 0;
      clip-path: polygon(0 0, 100% 0, 100% 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .segment-text {
      position: absolute;
      left: 50%;
      top: 25%;
      transform-origin: 0 100px;
      width: 100px;
      text-align: center;
      font-weight: bold;
      font-size: 14px;
      color: white;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
      transform: rotate(45deg);
    }

    #pointer {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 40px;
      background: #FF4500;
      clip-path: polygon(50% 100%, 0 0, 100% 0);
      z-index: 10;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    }

    #spin-button {
      display: block;
      margin: 30px auto 0;
      padding: 15px 40px;
      font-size: 1.2rem;
      background: linear-gradient(to bottom, #FF8C00, #FF4500);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }

    #spin-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      background: linear-gradient(to bottom, #FF9E20, #FF5510);
    }

    #spin-button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #result {
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      margin-top: 25px;
      min-height: 60px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      color: #8B4513;
    }

    /* ç®¡ç†åŒºåŸŸæ ·å¼ */
    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #8B4513;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #FFD700;
      border-radius: 8px;
      font-size: 1rem;
    }

    #add-button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(to bottom, #32CD32, #228B22);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #add-button:hover {
      background: linear-gradient(to bottom, #42DD42, #329B32);
      transform: translateY(-2px);
    }

    #options-list {
      list-style-type: none;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
      border: 2px solid #FFD700;
      border-radius: 8px;
      padding: 10px;
    }

    #options-list li {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      border-bottom: 1px dashed #eee;
      align-items: center;
    }

    #options-list li:last-child {
      border-bottom: none;
    }

    .remove-button {
      background: #FF4500;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .remove-button:hover {
      background: #ff2500;
      transform: scale(1.05);
    }

    .instructions {
      background: rgba(255, 255, 255, 0.7);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 25px;
      text-align: center;
      font-size: 1.1rem;
    }

    .setup-instructions {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      font-size: 0.9rem;
    }

    .setup-instructions h3 {
      color: #1976D2;
      margin-bottom: 10px;
    }

    .setup-instructions ol {
      padding-left: 20px;
    }

    .setup-instructions li {
      margin-bottom: 10px;
    }

    .setup-instructions input {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #1976D2;
      border-radius: 4px;
    }

    .auth-section {
      margin: 20px 0;
      text-align: center;
    }

    #auth-button {
      background: #1976D2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }

    #auth-button:hover {
      background: #1565C0;
    }

    footer {
      text-align: center;
      margin-top: 30px;
      padding: 20px;
      color: #8B4513;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
        align-items: center;
      }
      
      #wheel-container {
        width: 300px;
        height: 300px;
      }
      
      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ½ï¸ ä»Šæ—¥åˆé¤æ±ºå®šå™¨</h1>
      <div class="instructions">
        <p>é»æ“Šè½‰ç›¤æ±ºå®šä»Šå¤©åƒä»€éº¼ï¼é€£æ¥Google Sheetsä½œç‚ºè³‡æ–™åº«ä¾†æºã€‚</p>
      </div>
    </header>
    
    <div class="setup-instructions">
      <h3>è¨­å®šèªªæ˜</h3>
      <ol>
        <li>å»ºç«‹ä¸€å€‹Google Sheetï¼Œç¬¬ä¸€æ¬„(Aæ¬„)ç”¨æ–¼å­˜æ”¾åˆé¤é¸é …</li>
        <li>å•Ÿç”¨Google Sheets APIä¸¦å–å¾—APIé‡‘é‘°</li>
        <li>åœ¨ä¸‹æ–¹è¼¸å…¥æ‚¨çš„Google Sheet IDå’ŒAPIé‡‘é‘°</li>
        <li>é»æ“Šã€Œæˆæ¬Šé€£æ¥ã€æŒ‰éˆ•é€£æ¥è³‡æ–™åº«</li>
      </ol>
      
      <div class="form-group">
        <label for="sheet-id">Google Sheet ID:</label>
        <input type="text" id="sheet-id" placeholder="è«‹è¼¸å…¥Google Sheet ID">
      </div>
      
      <div class="form-group">
        <label for="api-key">API é‡‘é‘°:</label>
        <input type="password" id="api-key" placeholder="è«‹è¼¸å…¥Google Sheets APIé‡‘é‘°">
      </div>
    </div>
    
    <div class="auth-section">
      <button id="auth-button">æˆæ¬Šé€£æ¥</button>
    </div>
    
    <div class="main-content">
      <section class="wheel-section">
        <h2 class="section-title">å¹¸é‹è½‰ç›¤</h2>
        <div id="wheel-container">
          <div id="pointer"></div>
          <div id="wheel"></div>
        </div>
        <button id="spin-button" disabled>é–‹å§‹æ—‹è½‰</button>
        <div id="result">è«‹å…ˆé€£æ¥è³‡æ–™åº«</div>
      </section>
      
      <section class="management-section">
        <h2 class="section-title">è³‡æ–™ç®¡ç†</h2>
        <div class="form-group">
          <label for="new-option">æ–°å¢é¸é …:</label>
          <input type="text" id="new-option" placeholder="è¼¸å…¥åˆé¤é¸é …ï¼Œä¾‹å¦‚ï¼šç‰›è‚‰éºµã€å£½å¸ã€æ¼¢å ¡..." disabled>
        </div>
        <button id="add-button" disabled>æ–°å¢é¸é …</button>
        
        <h3 style="margin-top: 25px; color: #8B4513;">ç›®å‰é¸é …</h3>
        <ul id="options-list">
          <li>è«‹å…ˆé€£æ¥è³‡æ–™åº«ä»¥è¼‰å…¥é¸é …</li>
        </ul>
      </section>
    </div>
    
    <footer>
      <p>è³‡æ–™ä¾†æºç‚ºGoogle Sheetsï¼Œæ‰€æœ‰é¸é …å‡å¾é›²ç«¯è³‡æ–™åº«è®€å–å’Œæ›´æ–°</p>
    </footer>
  </div>

  <script>
    // Google Sheetsç›¸é—œè¨­å®š
    let SHEET_ID = '';
    let API_KEY = '';
    const RANGE = 'Sheet1!A:A'; // è®€å–ç¬¬ä¸€æ¬„æ‰€æœ‰è³‡æ–™
    
    // é¸é …åˆ—è¡¨
    let options = [];
    
    // è½‰ç›¤é¡è‰²
    const colors = [
      "#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0",
      "#9966FF", "#FF9F40", "#8AC926", "#1982C4",
      "#6A4C93", "#F15BB5", "#00BBF9", "#00F5D4"
    ];
    
    // DOMè¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
    });
    
    // è¨­ç½®äº‹ä»¶ç›£è½å™¨
    function setupEventListeners() {
      document.getElementById('auth-button').addEventListener('click', authenticate);
      document.getElementById('spin-button').addEventListener('click', spinWheel);
      document.getElementById('add-button').addEventListener('click', addOption);
      document.getElementById('new-option').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addOption();
        }
      });
    }
    
    // é©—è­‰ä¸¦é€£æ¥Google Sheets
    function authenticate() {
      SHEET_ID = document.getElementById('sheet-id').value.trim();
      API_KEY = document.getElementById('api-key').value.trim();
      
      if (!SHEET_ID || !API_KEY) {
        showResult('è«‹è¼¸å…¥å®Œæ•´çš„Google Sheetè³‡è¨Š');
        return;
      }
      
      // è¼‰å…¥é¸é …
      loadOptions();
    }
    
    // å¾Google Sheetsè¼‰å…¥é¸é …
    function loadOptions() {
      showResult('æ­£åœ¨è¼‰å…¥é¸é …...');
      
      fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            throw new Error(data.error.message);
          }
          
          // æ¸…ç†è³‡æ–™ï¼Œç§»é™¤ç©ºç™½å’Œæ¨™é¡Œè¡Œ
          options = data.values
            .flat()
            .filter(option => option && option.trim() !== '')
            .map(option => option.trim());
          
          if (options.length === 0) {
            options = ['ç‰›è‚‰éºµ', 'å£½å¸', 'æ¼¢å ¡', 'ç‚’é£¯', 'æŠ«è–©', 'æ°´é¤ƒ'];
            // åˆå§‹åŒ–è³‡æ–™åº«
            saveAllOptions();
          }
          
          updateOptionsList();
          drawWheel();
          
          // å•Ÿç”¨æ§åˆ¶é …
          document.getElementById('spin-button').disabled = false;
          document.getElementById('add-button').disabled = false;
          document.getElementById('new-option').disabled = false;
          
          showResult('è³‡æ–™è¼‰å…¥æˆåŠŸï¼');
        })
        .catch(error => {
          console.error('è¼‰å…¥é¸é …æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
          showResult(`è¼‰å…¥å¤±æ•—: ${error.message}`);
        });
    }
    
    // å„²å­˜æ‰€æœ‰é¸é …åˆ°Google Sheets
    function saveAllOptions() {
      const requestBody = {
        values: options.map(option => [option])
      };
      
      fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}:clear?alt=json`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${gapi.auth.getToken().access_token}`,
          'Content-Type': 'application/json'
        }
      }).then(() => {
        // æ¸…é™¤å¾Œå¯«å…¥æ–°è³‡æ–™
        return fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1!A1:A${options.length}?valueInputOption=RAW&alt=json`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${gapi.auth.getToken().access_token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });
      }).catch(error => {
        console.error('å„²å­˜é¸é …æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
      });
    }
    
    // æ–°å¢å–®ä¸€é¸é …åˆ°Google Sheets
    function saveOption(option) {
      const requestBody = {
        values: [[option]]
      };
      
      fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values:append?range=Sheet1!A:A&valueInputOption=RAW&insertDataOption=INSERT_ROWS&alt=json`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${gapi.auth.getToken().access_token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestBody)
      }).catch(error => {
        console.error('æ–°å¢é¸é …æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
      });
    }
    
    // å¾Google Sheetsåˆªé™¤é¸é …
    function deleteOption(index) {
      // æ³¨æ„ï¼šåœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦æ›´è¤‡é›œçš„é‚è¼¯ä¾†è™•ç†åˆªé™¤æ“ä½œ
      // é€™è£¡ç°¡åŒ–è™•ç†ï¼Œé‡æ–°å¯«å…¥æ•´å€‹åˆ—è¡¨
      saveAllOptions();
    }
    
    // æ›´æ–°é¸é …åˆ—è¡¨
    function updateOptionsList() {
      const optionsList = document.getElementById('options-list');
      optionsList.innerHTML = '';
      
      if (options.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'æš«ç„¡é¸é …';
        optionsList.appendChild(li);
        return;
      }
      
      options.forEach((option, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${option}</span>
          <button class="remove-button" data-index="${index}">åˆªé™¤</button>
        `;
        optionsList.appendChild(li);
      });
      
      // ç¶å®šåˆªé™¤æŒ‰éˆ•äº‹ä»¶
      document.querySelectorAll('.remove-button').forEach(button => {
        button.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          removeOption(index);
        });
      });
    }
    
    // ç¹ªè£½è½‰ç›¤
    function drawWheel() {
      const wheel = document.getElementById('wheel');
      wheel.innerHTML = '';
      
      if (options.length === 0) {
        wheel.style.background = '#f0f0f0';
        return;
      }
      
      const segmentAngle = 360 / options.length;
      
      options.forEach((option, index) => {
        const segment = document.createElement('div');
        segment.className = 'wheel-segment';
        segment.style.transform = `rotate(${index * segmentAngle}deg)`;
        segment.style.backgroundColor = colors[index % colors.length];
        
        const text = document.createElement('div');
        text.className = 'segment-text';
        text.textContent = option;
        text.style.transform = `rotate(${segmentAngle/2}deg)`;
        
        segment.appendChild(text);
        wheel.appendChild(segment);
      });
    }
    
    // æ–°å¢é¸é …
    function addOption() {
      const input = document.getElementById('new-option');
      const value = input.value.trim();
      
      if (!value) {
        showResult('è«‹è¼¸å…¥é¸é …åç¨±');
        return;
      }
      
      if (options.includes(value)) {
        showResult('é¸é …å·²å­˜åœ¨ï¼');
        return;
      }
      
      options.push(value);
      saveOption(value); // å„²å­˜åˆ°Google Sheets
      updateOptionsList();
      drawWheel();
      input.value = '';
      showResult(`å·²æ–°å¢é¸é …: ${value}`);
    }
    
    // åˆªé™¤é¸é …
    function removeOption(index) {
      if (index < 0 || index >= options.length) return;
      
      const removed = options.splice(index, 1)[0];
      saveAllOptions(); // é‡æ–°å„²å­˜æ‰€æœ‰é¸é …åˆ°Google Sheets
      updateOptionsList();
      drawWheel();
      showResult(`å·²åˆªé™¤é¸é …: ${removed}`);
    }
    
    // æ—‹è½‰è½‰ç›¤
    function spinWheel() {
      if (options.length < 2) {
        showResult('è‡³å°‘éœ€è¦å…©å€‹é¸é …æ‰èƒ½æ—‹è½‰ï¼');
        return;
      }
      
      const spinButton = document.getElementById('spin-button');
      spinButton.disabled = true;
      showResult('æ—‹è½‰ä¸­...');
      
      const wheel = document.getElementById('wheel');
      const spins = 5; // æ—‹è½‰åœˆæ•¸
      const extraDegrees = Math.floor(Math.random() * 360);
      const totalDegrees = spins * 360 + extraDegrees;
      
      wheel.style.transform = `rotate(${totalDegrees}deg)`;
      
      // è¨ˆç®—çµæœ
      setTimeout(() => {
        const segmentAngle = 360 / options.length;
        // èª¿æ•´è§’åº¦è¨ˆç®—ä»¥æ­£ç¢ºç²å–çµæœ
        const normalizedDegrees = (360 - (totalDegrees % 360)) % 360;
        const selectedIndex = Math.floor(normalizedDegrees / segmentAngle);
        const result = options[selectedIndex];
        
        showResult(`ä»Šå¤©åˆé¤åƒ: ${result}`);
        spinButton.disabled = false;
      }, 5000);
    }
    
    // é¡¯ç¤ºçµæœ
    function showResult(message) {
      document.getElementById('result').textContent = message;
    }
  </script>
</body>
</html>